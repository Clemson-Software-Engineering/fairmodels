---
title: "FairModels_User_Guide"
output: html_document
vignette: >
  %\VignetteIndexEntry{General introduction: Survival on the RMS Titanic}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, cache = TRUE}
knitr::opts_chunk$set(
  collapse = FALSE,
  warning = FALSE,
  message = FALSE)
```

```{r setup, }
library(fairmodels)

library(ranger)

library(DALEX)
library(fairness) # only for data
```


Lets say that we have dataset: 
```{r}
df <- fairness::compas[,1:7]
df$Two_yr_Recidivism <- as.factor(as.numeric(df$Two_yr_Recidivism)-1)
head(df)
```

And we make some diffrent models and explainers via `DALEX`

```{r, results="hide", cache = TRUE}
y_numeric <- as.numeric(df$Two_yr_Recidivism)-1

rf_1 <- ranger(Two_yr_Recidivism ~., data = df, probability = TRUE)  # Wszystko
rf_2 <- ranger(Two_yr_Recidivism ~Number_of_Priors+Age_Below_TwentyFive, data = df, probability = TRUE) 
lr_1 <- glm(Two_yr_Recidivism~., data=df, family=binomial(link="logit"))
rf_3<- ranger(Two_yr_Recidivism ~ Age_Above_FourtyFive+Misdemeanor, data = df, probability = TRUE) # dziwny model
lr_2 <- glm(Two_yr_Recidivism ~Number_of_Priors+Age_Below_TwentyFive, data = df, family=binomial(link="logit")) # Wszystko
rf_4 <- ranger(Two_yr_Recidivism ~ Female+Misdemeanor+ethnicity+Number_of_Priors+Age_Below_TwentyFive, data = df, probability = TRUE) # dziwny model

 # explainers
 explainer_1 <- explain(rf_1, data = df, y = y_numeric)
 explainer_2 <- explain(lr_1, data = df, y = y_numeric)
 explainer_3 <- explain(rf_2, data = df, y = y_numeric)
 explainer_4 <- explain(rf_3, data = df, y = y_numeric)
 explainer_5 <- explain(lr_2, data = df, y = y_numeric)
 explainer_6 <- explain(rf_4, data = df, y = y_numeric)
 

 # diffrent labels
 explainer_3$label <- "ranger2"
 explainer_4$label <- "ranger3"
 explainer_5$label <- "lm2"
 explainer_6$label <- "ranger4"


 
```

Let's use our first functionality
```{r}
fobject <- create_fairness_object(explainer_1,explainer_2,explainer_3,explainer_4,explainer_5,explainer_6,
                                   outcome = "Two_yr_Recidivism",
                                   group  = "ethnicity",
                                   base   = "Caucasian")
```
```{r}
# progres to be expected
?create_fairness_object
```



Now let's see what is inside

```{r}
print(fobject)
```

## Group metrics

If we want to chceck how model performs in all fairness metrics, then we have got 3 options: 

1. Heatmap
```{r}
heatmap(fobject)
```

2.PCA 

Creating `fairness_pca` object. 
```{r}
fpca <- create_fairness_pca(fobject)
print(fpca)
```

Plotting
```{r}
plot(fpca)
```
   
TODO : KNN can be added, groups chosen by knn can by in one color or in some kind of circle  


3. Stacked Barplot 

Fairly easy to understand and intiutive. 
```{r}
fairmodels::plot_stacked_barplot(fobject)
```

