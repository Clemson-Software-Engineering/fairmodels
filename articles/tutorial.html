<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tutorial • FairModels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="tutorial">
<meta property="og:description" content="FairModels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">FairModels</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.1.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">tutorial</a>
    </li>
  </ul>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>tutorial</h1>
                        <h4 class="author">Jakub Wiśniewski</h4>
            
      
      
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="objects-and-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#objects-and-structure" class="anchor"></a>Objects and Structure</h1>
<div id="why" class="section level2">
<h2 class="hasAnchor">
<a href="#why" class="anchor"></a>Why?</h2>
<p>Let’s say you are building court system that predicts if someone will become recidivist in the futre. First you gather information then you build a model and predict outcomes. You get accuracy score of 90%. It is preety good, but it appears that the model is more likely to say that African Americans will become recidivists. Model was trained on data that was discriminating certain ethnic groups. So now we have some options. First one is to change the data, and the second one is to tune model, and check if it behaves as we would like it to be. We will choose the second option.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>We will use modified ProPublica’s compass data to represent our problem.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"compas"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">compas</span>)</pre></body></html></div>
<pre><code>#&gt;    Two_yr_Recidivism Number_of_Priors Age_Above_FourtyFive Age_Below_TwentyFive
#&gt; 4                  0       -0.6843578                   no                   no
#&gt; 5                  1        2.2668817                   no                   no
#&gt; 7                  0       -0.6843578                   no                   no
#&gt; 11                 0       -0.6843578                   no                   no
#&gt; 14                 0       -0.6843578                   no                   no
#&gt; 24                 0       -0.6843578                   no                   no
#&gt;       Sex Misdemeanor        Ethnicity
#&gt; 4    Male         yes            Other
#&gt; 5    Male          no        Caucasian
#&gt; 7  Female         yes        Caucasian
#&gt; 11   Male          no African_American
#&gt; 14   Male         yes         Hispanic
#&gt; 24   Male         yes            Other</code></pre>
<p>We train and explain our model with <code>DALEX</code></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Train</span>
<span class="no">rf_compas</span> <span class="kw">&lt;-</span> <span class="fu">ranger</span>(<span class="no">Two_yr_Recidivism</span> ~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="co"># Wszystko</span>

<span class="co"># numeric target values</span>
<span class="no">y_numeric</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">compas</span>$<span class="no">Two_yr_Recidivism</span>)-<span class="fl">1</span>

<span class="co"># explainer</span>
<span class="no">rf_explainer</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">rf_compas</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>)</pre></body></html></div>
<pre><code>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  ranger  ( [33m default [39m )
#&gt;   -&gt; data              :  6172  rows  6  cols 
#&gt;   -&gt; target variable   :  6172  values 
#&gt;   -&gt; model_info        :  package ranger , ver. 0.12.1 , task classification ( [33m default [39m ) 
#&gt;   -&gt; predict function  :  yhat.ranger  will be used ( [33m default [39m )
#&gt;   -&gt; predicted values  :  numerical, min =  0.1603076 , mean =  0.5448919 , max =  0.8609738  
#&gt;   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
#&gt;   -&gt; residuals         :  numerical, min =  -0.8428607 , mean =  -1.178066e-05 , max =  0.7884089  
#&gt;  [32m A new explainer has been created! [39m</code></pre>
<p>Than we create <code>fairness_object</code> with <code><a href="../reference/create_fairness_object.html">create_fairness_object()</a></code></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fobject</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_fairness_object.html">create_fairness_object</a></span>(<span class="no">rf_explainer</span>,
                                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="co"># it is important to specify all data if explainer doesn't have it</span>
                                  <span class="kw">outcome</span> <span class="kw">=</span> <span class="st">"Two_yr_Recidivism"</span>, <span class="co"># target variable</span>
                                  <span class="kw">group</span>  <span class="kw">=</span> <span class="st">"Ethnicity"</span>,          <span class="co"># protected group</span>
                                  <span class="kw">base</span>   <span class="kw">=</span> <span class="st">"Caucasian"</span>)          <span class="co"># to what subgroupwe want to compare</span>
                                                                 <span class="co"># cutoff - optional, deafult = 0.5</span></pre></body></html></div>
<p>And we plot!</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fobject</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>As we can see it is more likely that model will categorise African Americans as future recidivists than for example Asians. But mabey some groups are statisticaly more likely to go do crimes in the future. It is possible, but there are more ways that the model can discriminate people.</p>
</div>
<div id="fairness-object" class="section level2">
<h2 class="hasAnchor">
<a href="#fairness-object" class="anchor"></a>Fairness Object</h2>
<p>To really see what <code>fairness_object</code> is about, we need to make some more models and explainers.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123</span>)

<span class="no">rf_compas_1</span> <span class="kw">&lt;-</span> <span class="fu">ranger</span>(<span class="no">Two_yr_Recidivism</span> ~<span class="no">Number_of_Priors</span>+<span class="no">Age_Below_TwentyFive</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">lr_compas_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">Two_yr_Recidivism</span>~<span class="no">.</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">compas</span>, <span class="kw">family</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(<span class="kw">link</span><span class="kw">=</span><span class="st">"logit"</span>))
<span class="no">rf_compas_2</span> <span class="kw">&lt;-</span> <span class="fu">ranger</span>(<span class="no">Two_yr_Recidivism</span> ~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">rf_compas_3</span> <span class="kw">&lt;-</span> <span class="fu">ranger</span>(<span class="no">Two_yr_Recidivism</span> ~ <span class="no">Age_Above_FourtyFive</span>+<span class="no">Misdemeanor</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">rf_compas_4</span> <span class="kw">&lt;-</span> <span class="fu">ranger</span>(<span class="no">Two_yr_Recidivism</span> ~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>, <span class="kw">probability</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">compas</span>
<span class="no">df</span>$<span class="no">Two_yr_Recidivism</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">compas</span>$<span class="no">Two_yr_Recidivism</span>)-<span class="fl">1</span>
<span class="no">gbm_compas_1</span><span class="kw">&lt;-</span> <span class="fu">gbm</span>(<span class="no">Two_yr_Recidivism</span>~<span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">df</span>)

<span class="no">explainer_1</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">rf_compas_1</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>)
<span class="no">explainer_2</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">lr_compas_1</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>)
<span class="no">explainer_3</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">rf_compas_2</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="st">"ranger_2"</span>)
<span class="no">explainer_4</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">rf_compas_3</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="st">"ranger_3"</span>)
<span class="no">explainer_5</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">gbm_compas_1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>)
<span class="no">explainer_6</span> <span class="kw">&lt;-</span> <span class="fu">explain</span>(<span class="no">rf_compas_4</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>[,-<span class="fl">1</span>], <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_numeric</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="st">"ranger_4"</span>)</pre></body></html></div>
<p>Now we create one object with all explainers</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fobject</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_fairness_object.html">create_fairness_object</a></span>(<span class="no">explainer_1</span>,<span class="no">explainer_2</span>,<span class="no">explainer_3</span>,<span class="no">explainer_4</span>,<span class="no">explainer_5</span>,<span class="no">explainer_6</span>,
                                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>,
                                  <span class="kw">outcome</span> <span class="kw">=</span> <span class="st">"Two_yr_Recidivism"</span>,
                                  <span class="kw">group</span>  <span class="kw">=</span> <span class="st">"Ethnicity"</span>,
                                  <span class="kw">base</span>   <span class="kw">=</span> <span class="st">"Caucasian"</span>)</pre></body></html></div>
<p>As we can see there is some parameters in fobject such as:<br>
1. DALEX Explainer or list of explainers<br>
2. data - if first explainer was not provided with whole data frame, we should do it here<br>
3. outcome - target variable, what we want to predict<br>
4. group - protected group/ sensitive variable which can be unfairly treated<br>
5. base - to what subgroup we want to compare metric scores with. If not provided gets first subgroup in data.</p>
<p>What consists of fairness object?</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">fobject</span>)</pre></body></html></div>
<pre><code>#&gt; Fairness Matrics: 
#&gt;   equal_odds pred_rate_parity acc_parity fnr_parity fpr_parity npv_parity
#&gt; 1  1.5803060        0.7820673  0.4500568  1.7007271  1.2013032  0.5153328
#&gt; 2  2.8289962        1.4264519  0.2037848  2.7201109  1.8593806  0.1655958
#&gt; 3  1.8188817        0.6388394  0.5111515  1.8830200  1.4173104  0.5750418
#&gt; 4  0.7290221        0.7617980  0.3320299  0.9987922  0.8397114  0.7206892
#&gt; 5  2.2816360        1.0073363  0.3732516  1.9837027  1.7778982  0.3839622
#&gt; 6  1.5807925        0.5644851  0.4127110  1.9813949  1.2317863  0.4800093
#&gt;   spec_parity mcc_parity model labels
#&gt; 1   0.3860846   1.979338       ranger
#&gt; 2   0.5333551   2.575408           lm
#&gt; 3   0.3483848   2.299768     ranger_2
#&gt; 4   0.5965355   2.208520     ranger_3
#&gt; 5   0.4364146   2.563100          gbm
#&gt; 6   0.3687596   1.616572     ranger_4
#&gt; Models explained:
#&gt; [1] "ranger"
#&gt; [1] "lm"
#&gt; [1] "ranger_2"
#&gt; [1] "ranger_3"
#&gt; [1] "gbm"
#&gt; [1] "ranger_4"
#&gt; 
#&gt; Data: 
#&gt;   Two_yr_Recidivism Number_of_Priors Age_Above_FourtyFive Age_Below_TwentyFive
#&gt; 4                 0       -0.6843578                   no                   no
#&gt; 5                 1        2.2668817                   no                   no
#&gt;    Sex Misdemeanor Ethnicity probabilities
#&gt; 4 Male         yes     Other     0.7812803
#&gt; 5 Male          no Caucasian     0.3194314</code></pre>
<p>Fairness object gets metrics based on confussion matrix and checks them over the groups.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># for the first model</span>
<span class="no">fobject</span>$<span class="no">groups_data</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">fpr_parity</span></pre></body></html></div>
<pre><code>#&gt;        Caucasian African_American            Asian         Hispanic 
#&gt;        1.0000000        0.5976741        1.1001071        1.0430645 
#&gt;  Native_American            Other 
#&gt;        0.3520343        1.0078400</code></pre>
<p>If we were going only to take score from certain metric (Let’s say fpr and 0.3) we wouldn’t know if it is good or bad. But we are aiming for <strong>equal treatment over all groups</strong> so if this metric score would be the same in all groups it would be very good. But the metrics wouldn’t be comparable between each others (fpr - 0.3 in all groups and acc_parity - 0.9 in all groups, both are good in terms of parity). That is wy we use <strong>base</strong> - to set benchmark. And for example Caucasian in fpr had score of 0.3 and African American 0.6. After setting <code>base = Caucasian</code> Caucasian would have score 1, and African American 2, because is two times higher score in fpr.</p>
<p><em>Note: When dealing with aggregating plots we use formula sum(abs(1-score)) to represent aggregated score in metrics. In short is how much it differs from ideal scores.</em></p>
</div>
</div>
<div id="choosing-best-model" class="section level1">
<h1 class="hasAnchor">
<a href="#choosing-best-model" class="anchor"></a>Choosing best model</h1>
<p>We now have a few models in our <code>fairness_object</code></p>
<p>Let’s see how they perform in diffrent metrics.</p>
<div id="stacked-barplot" class="section level2">
<h2 class="hasAnchor">
<a href="#stacked-barplot" class="anchor"></a>Stacked Barplot</h2>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_stacked_barplot.html">plot_stacked_barplot</a></span>(<span class="no">fobject</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>At first we see that lm is the worst overall model. It does not give us information if plots are similar to each other.</p>
</div>
<div id="plot-fairness-pca" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-fairness-pca" class="anchor"></a>Plot fairness PCA</h2>
<p>With this task we should use <code>PCA</code>. We call <code><a href="../reference/create_fairness_pca.html">create_fairness_pca()</a></code> to create fairness pca object.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">fair_pca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_fairness_pca.html">create_fairness_pca</a></span>(<span class="no">fobject</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">fair_pca</span>)</pre></body></html></div>
<pre><code>#&gt; Fairness PCA : 
#&gt;             PC1        PC2         PC3         PC4         PC5          PC6
#&gt; [1,]  1.0837140 -0.5836255  0.14905727 -0.41680780 -0.08358422 3.330669e-16
#&gt; [2,] -3.9546156  0.6791895  0.48133463 -0.04708664  0.14119289 6.661338e-16
#&gt; [3,]  0.8568839 -1.2711879 -0.95109734  0.06804739  0.25553456 2.775558e-17
#&gt; [4,]  2.1863884  2.5333952 -0.08990424  0.05665421  0.02606519 1.162482e-15
#&gt; [5,] -1.4452542 -0.2196268 -0.82072568  0.12819031 -0.29607245 1.110223e-16
#&gt; [6,]  1.2728834 -1.1381446  1.23133535  0.21100254 -0.04313597 2.220446e-16
#&gt; 
#&gt; Created with: 
#&gt; [1] "ranger"   "lm"       "ranger_2" "ranger_3" "gbm"      "ranger_4"
#&gt; 
#&gt; First two components explained 90 % of variance.</code></pre>
<p>Let’s plot!</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fair_pca</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>It is done with loadings plot, which can be customised.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fair_pca</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">0</span>) <span class="co"># deafult = 0.5</span></pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="plot-heatmap" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-heatmap" class="anchor"></a>Plot Heatmap</h2>
<p>Another way to deal with grouped data is using heatmap.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span>(<span class="no">fobject</span>, <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"With cool colors and dendograms"</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>For both models and metrics dendograms are created. This way through hierarchical clustering we can look on similarities between models/metrics. It should give similar but more detailed information than PCA</p>
<p>It can be normalised among metrics.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span>(<span class="no">fobject</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Title can be changed"</span>) <span class="co"># we can turn values off via text= FALSE</span></pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Now we know what those scores are and how “similar” models are to each other ## Metric and Performance Plot</p>
<p>Sometimes we would like to know how good are models in performance metrics and in fairness metrics at the same time, to see the tradeoff between them.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_performance_with_fairness.html">plot_performance_with_fairness</a></span>(<span class="no">fobject</span>, <span class="kw">fairness_metric</span> <span class="kw">=</span> <span class="st">"fpr_parity"</span>)</pre></body></html></div>
<pre><code>#&gt; Performace metric is NULL, setting deafult ( auc )  
#&gt; 
#&gt; Creating object with: 
#&gt; Fairness metric fpr_parity 
#&gt; Performance metric  auc</code></pre>
<p><img src="tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>We can add plots with help of <code>patchwork</code></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patchwork</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_performance_with_fairness.html">plot_performance_with_fairness</a></span>(<span class="no">fobject</span>,  <span class="st">"equal_odds"</span>, <span class="st">"accuracy"</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_performance_with_fairness.html">plot_performance_with_fairness</a></span>(<span class="no">fobject</span>,  <span class="st">"fpr_parity"</span>, <span class="st">"auc"</span>)     + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">" "</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_performance_with_fairness.html">plot_performance_with_fairness</a></span>(<span class="no">fobject</span>,  <span class="st">"npv_parity"</span>, <span class="st">"recall"</span>)  + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">" "</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_performance_with_fairness.html">plot_performance_with_fairness</a></span>(<span class="no">fobject</span>,  <span class="st">"pred_rate_parity"</span>, <span class="st">"f1"</span>)+ <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">" "</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb23"><html><body><pre class="r">(<span class="no">p1</span> + <span class="no">p2</span>)/(<span class="no">p3</span>+<span class="no">p4</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div id="back-to-detail" class="section level2">
<h2 class="hasAnchor">
<a href="#back-to-detail" class="anchor"></a>Back to detail</h2>
<p>When we have narrowed down our search for the best model we can use <code>two_models_plot</code> to check once again metrics within groups and decide which model to use.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">fobject2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_fairness_object.html">create_fairness_object</a></span>(<span class="no">explainer_1</span>,<span class="no">explainer_3</span>,
                                   <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>,
                                  <span class="kw">outcome</span> <span class="kw">=</span> <span class="st">"Two_yr_Recidivism"</span>,
                                  <span class="kw">group</span>  <span class="kw">=</span> <span class="st">"Ethnicity"</span>,
                                  <span class="kw">base</span>   <span class="kw">=</span> <span class="st">"Caucasian"</span>)

<span class="fu"><a href="../reference/plot_two_models.html">plot_two_models</a></span>(<span class="no">fobject2</span>, <span class="kw">fairness_metric</span> <span class="kw">=</span> <span class="st">"fpr_parity"</span>) <span class="co"># both fairness_metric and performance_metric have deafult values</span></pre></body></html></div>
<pre><code>#&gt; Performace metric is NULL, setting deafult ( auc )  
#&gt; 
#&gt; Creating object with: 
#&gt; Fairness metric fpr_parity 
#&gt; Performance metric  auc 
#&gt; [1] "auc"</code></pre>
<p><img src="tutorial_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>We can also use simple <code>plot</code> when we have only few explainers.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fobject2</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Of course the protected group can be changed.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">fobject3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_fairness_object.html">create_fairness_object</a></span>(<span class="no">explainer_2</span>,<span class="no">explainer_5</span>,
                                   <span class="kw">data</span> <span class="kw">=</span> <span class="no">compas</span>,
                                  <span class="kw">outcome</span> <span class="kw">=</span> <span class="st">"Two_yr_Recidivism"</span>,
                                  <span class="kw">group</span>  <span class="kw">=</span> <span class="st">"Sex"</span>,
                                  <span class="kw">base</span> <span class="kw">=</span> <span class="st">"Female"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">fobject3</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
